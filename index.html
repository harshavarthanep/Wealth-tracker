<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WealthSolo | Private Finance Tracker</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #6366f1;
            --secondary: #ec4899;
            --bg: #0f172a;
            --card-bg: #1e293b;
            --text-main: #f8fafc;
            --text-muted: #94a3b8;
            --success: #10b981;
            --danger: #ef4444;
            --blur-amount: 0px;
        }

        /* Light Mode Variables override */
        [data-theme="light"] {
            --bg: #f1f5f9;
            --card-bg: #ffffff;
            --text-main: #0f172a;
            --text-muted: #64748b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        
        body { background-color: var(--bg); color: var(--text-main); transition: background 0.3s ease; padding-bottom: 80px; }
        
        /* Utility */
        .hidden { display: none !important; }
        .blur-sensitive { filter: blur(var(--blur-amount)); transition: filter 0.3s; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        
        /* Header */
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; margin-bottom: 20px; }
        .logo { font-size: 1.5rem; font-weight: 700; background: linear-gradient(to right, var(--primary), var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .controls i { font-size: 1.2rem; margin-left: 20px; cursor: pointer; color: var(--text-muted); transition: 0.2s; }
        .controls i:hover { color: var(--primary); }

        /* Motivation Banner */
        .motivation-card {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            padding: 20px;
            border-radius: 16px;
            margin-bottom: 30px;
            box-shadow: 0 10px 25px -5px rgba(99, 102, 241, 0.4);
            position: relative;
            overflow: hidden;
        }
        .motivation-card h2 { font-size: 1.2rem; margin-bottom: 5px; }
        .motivation-card p { font-size: 0.9rem; opacity: 0.9; }
        .motivation-card i { position: absolute; right: -10px; bottom: -20px; font-size: 6rem; opacity: 0.2; transform: rotate(-15deg); }

        /* Dashboard Grid */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: var(--card-bg); padding: 20px; border-radius: 12px; border: 1px solid rgba(255,255,255,0.05); }
        .stat-card h3 { font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; }
        .stat-card .value { font-size: 1.8rem; font-weight: 700; }
        .stat-card .sub-text { font-size: 0.8rem; margin-top: 5px; }
        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }

        /* Charts Section */
        .chart-container { background: var(--card-bg); padding: 20px; border-radius: 16px; margin-bottom: 30px; height: 300px; }

        /* Actions & List */
        .action-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn { padding: 10px 20px; border-radius: 8px; border: none; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-2px); }
        
        .transaction-list { display: flex; flex-direction: column; gap: 10px; }
        .transaction-item { display: flex; justify-content: space-between; align-items: center; background: var(--card-bg); padding: 15px; border-radius: 10px; border-left: 4px solid var(--text-muted); }
        .t-income { border-left-color: var(--success); }
        .t-expense { border-left-color: var(--danger); }
        .t-details h4 { font-size: 1rem; }
        .t-details span { font-size: 0.8rem; color: var(--text-muted); }

        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: flex; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(5px); }
        .modal { background: var(--card-bg); padding: 30px; border-radius: 16px; width: 90%; max-width: 500px; position: relative; }
        .modal h2 { margin-bottom: 20px; }
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; margin-bottom: 8px; font-size: 0.9rem; color: var(--text-muted); }
        .form-group input, .form-group select { width: 100%; padding: 12px; background: var(--bg); border: 1px solid rgba(255,255,255,0.1); color: var(--text-main); border-radius: 8px; outline: none; }
        .close-modal { position: absolute; top: 20px; right: 20px; cursor: pointer; font-size: 1.5rem; }

        /* Floating Add Button (Mobile) */
        .fab { position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; background: var(--primary); border-radius: 50%; display: flex; justify-content: center; align-items: center; font-size: 1.5rem; color: white; box-shadow: 0 10px 20px rgba(99, 102, 241, 0.4); cursor: pointer; transition: 0.3s; }
        .fab:hover { transform: scale(1.1); }

        /* Goal Progress */
        .goals-section { margin-top: 40px; }
        .goal-card { background: var(--card-bg); padding: 20px; border-radius: 12px; margin-bottom: 15px; }
        .progress-bar-bg { background: rgba(255,255,255,0.1); height: 8px; border-radius: 4px; margin-top: 10px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--success); width: 0%; transition: width 1s ease; }

        @media (max-width: 768px) {
            .stats-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="logo"><i class="fa-solid fa-wallet"></i> WealthSolo</div>
        <div class="controls">
            <i class="fa-solid fa-eye-slash" id="privacyBtn" title="Privacy Mode"></i>
            <i class="fa-solid fa-moon" id="themeBtn" title="Toggle Theme"></i>
            <i class="fa-solid fa-download" id="exportBtn" title="Export Data"></i>
            <i class="fa-solid fa-upload" onclick="document.getElementById('importFile').click()" title="Import Data"></i>
            <input type="file" id="importFile" class="hidden" accept=".json">
        </div>
    </header>

    <div class="motivation-card">
        <h2 id="motivationTitle">Good Morning, Entrepreneur! ðŸš€</h2>
        <p id="motivationText">Analyzing your financial habits...</p>
        <i class="fa-solid fa-rocket"></i>
    </div>

    <div class="stats-grid">
        <div class="stat-card">
            <h3>Total Balance</h3>
            <div class="value blur-sensitive" id="totalBalance">$0.00</div>
            <div class="sub-text" id="runwayText">Runway: Calculating...</div>
        </div>
        <div class="stat-card">
            <h3>Income (Mo)</h3>
            <div class="value blur-sensitive trend-up" id="monthIncome">$0.00</div>
        </div>
        <div class="stat-card">
            <h3>Expenses (Mo)</h3>
            <div class="value blur-sensitive trend-down" id="monthExpense">$0.00</div>
        </div>
        <div class="stat-card">
            <h3>Savings Rate</h3>
            <div class="value" id="savingRate">0%</div>
            <div class="sub-text">Target: 20%</div>
        </div>
    </div>

    <div class="chart-container">
        <canvas id="financeChart"></canvas>
    </div>

    <div class="goals-section">
        <div class="action-bar">
            <h2>Active Goals</h2>
            <button class="btn btn-primary" onclick="openGoalModal()">+ New Goal</button>
        </div>
        <div id="goalsList">
            </div>
    </div>

    <div style="margin-top: 40px;">
        <div class="action-bar">
            <h2>Recent Transactions</h2>
        </div>
        <div class="transaction-list" id="transactionList">
            </div>
    </div>
</div>

<div class="fab" onclick="openModal()">
    <i class="fa-solid fa-plus"></i>
</div>

<div class="modal-overlay hidden" id="transactionModal">
    <div class="modal">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <h2>Add Transaction</h2>
        <form id="transForm">
            <div class="form-group">
                <label>Type</label>
                <select id="tType">
                    <option value="expense">Expense ðŸ”´</option>
                    <option value="income">Income ðŸŸ¢</option>
                </select>
            </div>
            <div class="form-group">
                <label>Description</label>
                <input type="text" id="tDesc" placeholder="e.g., Client Payment, AWS Bill" required>
            </div>
            <div class="form-group">
                <label>Amount</label>
                <input type="number" id="tAmount" placeholder="0.00" required>
            </div>
            <div class="form-group">
                <label>Category</label>
                <select id="tCategory">
                    <option value="General">General</option>
                    <option value="Business">Business</option>
                    <option value="Food">Food</option>
                    <option value="Transport">Transport</option>
                    <option value="Utilities">Utilities</option>
                    <option value="Freelance">Freelance</option>
                </select>
            </div>
            <button type="submit" class="btn btn-primary" style="width:100%">Save Transaction</button>
        </form>
    </div>
</div>

<div class="modal-overlay hidden" id="goalModal">
    <div class="modal">
        <span class="close-modal" onclick="closeGoalModal()">&times;</span>
        <h2>Set Financial Goal</h2>
        <form id="goalForm">
            <div class="form-group">
                <label>Goal Name</label>
                <input type="text" id="gName" placeholder="e.g., New MacBook" required>
            </div>
            <div class="form-group">
                <label>Target Amount</label>
                <input type="number" id="gTarget" placeholder="2000" required>
            </div>
            <div class="form-group">
                <label>Current Saved</label>
                <input type="number" id="gCurrent" placeholder="0" required>
            </div>
            <div class="form-group">
                <label>Target Date</label>
                <input type="date" id="gDate" required>
            </div>
            <div id="goalCalcPreview" style="margin-bottom:15px; font-size:0.9rem; color:var(--success);"></div>
            <button type="submit" class="btn btn-primary" style="width:100%">Create Goal</button>
        </form>
    </div>
</div>

<script>
    // --- STATE MANAGEMENT ---
    let appData = {
        transactions: [],
        goals: [],
        settings: {
            currency: 'USD',
            theme: 'dark'
        }
    };

    // Load Data on Init
    const savedData = localStorage.getItem('wealthSoloData');
    if (savedData) {
        appData = JSON.parse(savedData);
        // Apply saved theme
        document.documentElement.setAttribute('data-theme', appData.settings.theme);
    }

    // --- CORE LOGIC ---

    function saveData() {
        localStorage.setItem('wealthSoloData', JSON.stringify(appData));
        updateDashboard();
    }

    function updateDashboard() {
        const transactions = appData.transactions;
        const totalBalance = transactions.reduce((acc, t) => t.type === 'income' ? acc + t.amount : acc - t.amount, 0);
        
        // Month Calculations
        const currentMonth = new Date().getMonth();
        const monthlyTrans = transactions.filter(t => new Date(t.date).getMonth() === currentMonth);
        const income = monthlyTrans.filter(t => t.type === 'income').reduce((a, b) => a + b.amount, 0);
        const expense = monthlyTrans.filter(t => t.type === 'expense').reduce((a, b) => a + b.amount, 0);
        
        // Runway Logic (Avg expense over last 3 months)
        // Simplified for MVP: Uses current month expense if history is short
        const avgExpense = expense || 1; 
        const runwayMonths = (totalBalance / avgExpense).toFixed(1);

        // DOM Updates
        document.getElementById('totalBalance').innerText = formatMoney(totalBalance);
        document.getElementById('monthIncome').innerText = formatMoney(income);
        document.getElementById('monthExpense').innerText = formatMoney(expense);
        document.getElementById('runwayText').innerText = totalBalance > 0 ? `Runway: ${runwayMonths} Months` : 'Runway: 0 Months';

        // Savings Rate
        const rate = income > 0 ? ((income - expense) / income) * 100 : 0;
        document.getElementById('savingRate').innerText = rate.toFixed(1) + '%';

        renderTransactions();
        renderGoals();
        updateChart();
        runMotivationalAI(income, expense, rate);
    }

    // --- MOTIVATIONAL AI ASSISTANT ---
    function runMotivationalAI(income, expense, rate) {
        const title = document.getElementById('motivationTitle');
        const text = document.getElementById('motivationText');
        const icon = document.querySelector('.motivation-card i');

        // Logic to compare with stored history (simulated for single file simplicity)
        // In a V2, we would store historical monthly data explicitly.
        
        if (rate > 20) {
            title.innerText = "You are on Fire! ðŸ”¥";
            text.innerText = `You saved ${rate.toFixed(1)}% of your income this month. That's better than 80% of people!`;
            icon.className = "fa-solid fa-fire";
        } else if (expense > income) {
            title.innerText = "Warning: Turbulence Ahead âš ï¸";
            text.innerText = "Your expenses are higher than income. Check the 'Runway' metric.";
            icon.className = "fa-solid fa-triangle-exclamation";
        } else if (appData.transactions.length === 0) {
            title.innerText = "Welcome to Financial Freedom ðŸš€";
            text.innerText = "Add your first transaction to unlock analytics and start your journey.";
        } else {
            title.innerText = "Steady Progress ðŸ“ˆ";
            text.innerText = "You are in the green. Try to cut one subscription to boost savings by 1%.";
            icon.className = "fa-solid fa-chart-line";
        }
    }

    // --- CHART.JS INTEGRATION ---
    let financeChart;
    function updateChart() {
        const ctx = document.getElementById('financeChart').getContext('2d');
        
        // Group by Date (Last 7 transactions or days)
        // Simplified: Showing Income vs Expense Distribution
        const data = {
            labels: ['Income', 'Expenses', 'Savings'],
            datasets: [{
                label: 'Financial Breakdown',
                data: [
                    parseFloat(document.getElementById('monthIncome').innerText.replace(/[^0-9.-]+/g,"")),
                    parseFloat(document.getElementById('monthExpense').innerText.replace(/[^0-9.-]+/g,"")),
                    parseFloat(document.getElementById('totalBalance').innerText.replace(/[^0-9.-]+/g,""))
                ],
                backgroundColor: ['#10b981', '#ef4444', '#6366f1'],
                borderWidth: 0
            }]
        };

        if (financeChart) financeChart.destroy();
        
        financeChart = new Chart(ctx, {
            type: 'bar', // Can be changed to 'doughnut' or 'line'
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: { beginAtZero: true, grid: { color: 'rgba(255,255,255,0.1)' } },
                    x: { grid: { display: false } }
                }
            }
        });
    }

    // --- DOM RENDERING ---

    function renderTransactions() {
        const list = document.getElementById('transactionList');
        list.innerHTML = '';
        const recent = appData.transactions.slice().reverse().slice(0, 10); // Last 10

        recent.forEach(t => {
            const div = document.createElement('div');
            div.className = `transaction-item t-${t.type} blur-sensitive`;
            div.innerHTML = `
                <div class="t-details">
                    <h4>${t.description}</h4>
                    <span>${t.category} â€¢ ${t.date}</span>
                </div>
                <div style="font-weight:bold; color: ${t.type === 'income' ? 'var(--success)' : 'var(--danger)'}">
                    ${t.type === 'income' ? '+' : '-'}${formatMoney(t.amount)}
                </div>
            `;
            list.appendChild(div);
        });
    }

    function renderGoals() {
        const list = document.getElementById('goalsList');
        list.innerHTML = '';
        
        appData.goals.forEach(g => {
            const percent = Math.min(100, (g.current / g.target) * 100).toFixed(1);
            
            // Calculator: How much to save daily?
            const today = new Date();
            const targetDate = new Date(g.date);
            const diffTime = Math.abs(targetDate - today);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
            const needed = (g.target - g.current);
            const dailySave = diffDays > 0 ? (needed / diffDays).toFixed(2) : 0;

            const div = document.createElement('div');
            div.className = 'goal-card';
            div.innerHTML = `
                <div style="display:flex; justify-content:space-between;">
                    <h4>${g.name}</h4>
                    <span class="blur-sensitive">${formatMoney(g.current)} / ${formatMoney(g.target)}</span>
                </div>
                <div class="progress-bar-bg">
                    <div class="progress-bar-fill" style="width: ${percent}%"></div>
                </div>
                <div style="font-size:0.8rem; color:var(--text-muted); margin-top:8px; display:flex; justify-content:space-between;">
                    <span>${diffDays} days left</span>
                    <span>Save <b>$${dailySave}</b>/day to reach this!</span>
                </div>
            `;
            list.appendChild(div);
        });
    }

    // --- HELPERS ---
    function formatMoney(amount) {
        return new Intl.NumberFormat('en-US', { style: 'currency', currency: appData.settings.currency }).format(amount);
    }

    // --- EVENT LISTENERS (MODALS & FORMS) ---

    // Transactions
    const tModal = document.getElementById('transactionModal');
    function openModal() { tModal.classList.remove('hidden'); }
    function closeModal() { tModal.classList.add('hidden'); }

    document.getElementById('transForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const t = {
            id: Date.now(),
            type: document.getElementById('tType').value,
            description: document.getElementById('tDesc').value,
            amount: parseFloat(document.getElementById('tAmount').value),
            category: document.getElementById('tCategory').value,
            date: new Date().toLocaleDateString()
        };
        appData.transactions.push(t);
        saveData();
        closeModal();
        e.target.reset();
    });

    // Goals
    const gModal = document.getElementById('goalModal');
    function openGoalModal() { gModal.classList.remove('hidden'); }
    function closeGoalModal() { gModal.classList.add('hidden'); }
    
    // Live Goal Calculator in Modal
    document.getElementById('gTarget').addEventListener('input', updateGoalCalc);
    document.getElementById('gDate').addEventListener('change', updateGoalCalc);
    
    function updateGoalCalc() {
        const target = parseFloat(document.getElementById('gTarget').value) || 0;
        const current = parseFloat(document.getElementById('gCurrent').value) || 0;
        const dateVal = document.getElementById('gDate').value;
        
        if(target && dateVal) {
            const days = Math.ceil((new Date(dateVal) - new Date()) / (1000 * 60 * 60 * 24));
            if(days > 0) {
                const daily = ((target - current) / days).toFixed(2);
                document.getElementById('goalCalcPreview').innerText = `ðŸ’¡ Insight: Save $${daily} daily to hit this goal.`;
            }
        }
    }

    document.getElementById('goalForm').addEventListener('submit', (e) => {
        e.preventDefault();
        const g = {
            id: Date.now(),
            name: document.getElementById('gName').value,
            target: parseFloat(document.getElementById('gTarget').value),
            current: parseFloat(document.getElementById('gCurrent').value),
            date: document.getElementById('gDate').value
        };
        appData.goals.push(g);
        saveData();
        closeGoalModal();
        e.target.reset();
    });

    // Close modals on outside click
    window.onclick = function(event) {
        if (event.target == tModal) closeModal();
        if (event.target == gModal) closeGoalModal();
    }

    // --- UTILITIES (Privacy, Theme, Export) ---

    // Privacy Mode (Blur)
    let privacy = false;
    document.getElementById('privacyBtn').addEventListener('click', () => {
        privacy = !privacy;
        document.documentElement.style.setProperty('--blur-amount', privacy ? '6px' : '0px');
        document.getElementById('privacyBtn').classList.toggle('fa-eye');
        document.getElementById('privacyBtn').classList.toggle('fa-eye-slash');
    });

    // Theme Toggle
    document.getElementById('themeBtn').addEventListener('click', () => {
        const newTheme = appData.settings.theme === 'dark' ? 'light' : 'dark';
        appData.settings.theme = newTheme;
        document.documentElement.setAttribute('data-theme', newTheme);
        document.getElementById('themeBtn').classList.toggle('fa-sun');
        document.getElementById('themeBtn').classList.toggle('fa-moon');
        saveData();
    });

    // Export Data
    document.getElementById('exportBtn').addEventListener('click', () => {
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(appData));
        const downloadAnchorNode = document.createElement('a');
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "wealth_backup.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        downloadAnchorNode.remove();
    });

    // Import Data
    document.getElementById('importFile').addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const importedData = JSON.parse(e.target.result);
                appData = importedData;
                saveData();
                alert('Data restored successfully!');
                location.reload();
            } catch (err) {
                alert('Invalid Backup File');
            }
        };
        reader.readAsText(file);
    });

    // Initialize
    updateDashboard();

</script>
</body>
</html>
